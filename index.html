<html>
<head>
<title>Speed test</title>
<script type="text/javascript">
function upload(s) {
  console.log("Start upload");
  var xhr = new XMLHttpRequest();
  var url = "./server/";
  var params = "module=upload"
  var size = s * 1024 * 1024; //s'MB
  var buffer = new ArrayBuffer(size);
  var int8View = new Int8Array(buffer);
  for (var i=0; i<int8View.length; i++) {
    int8View[i] = i;
  }
  xhr.open('POST', url+"?"+params, true);
  xhr.send(int8View);
  var startTime = new Date().getTime();
  xhr.onreadystatechange = processUploadRequest;
  function processUploadRequest() {
    if(xhr.readyState == 4 && xhr.status == 200) {
      var endTime = new Date().getTime();
      var elapsedTime = endTime - startTime;
      var uploadSpeed = (s*8/(elapsedTime/1000));
      console.log(uploadSpeed);
    }
  }
}
// Creating Dowload Speed Test request to server
function download(s) {
  console.log("Start download");
  var xhr = new XMLHttpRequest();
  var url = "./server/";
  var params = "module=download&size="
  var size = s * 1024 *1024; // s'MB
  xhr.open('GET', url+"?"+params+size, true);
  //console.log(xhr);
  xhr.send();
  var startTime = new Date().getTime();
  //event listener for http request
  xhr.onreadystatechange = processDownloadRequest;
  function processDownloadRequest() {
    //msg received 
    if (xhr.readyState == 4 && xhr.status == 200 ){
      var endTime = new Date().getTime();
      var elapsedTime = endTime - startTime; //ms
      var downloadSpeed = (s*8/(elapsedTime/1000));
      console.log(downloadSpeed);
      document.getElementById('download_res').innerHTML = downloadSpeed;
    }
      
  }
}
</script>
</head>
<body>
  <button type="button" onclick="download(50)"> Download Test </button>
  <button type="button" onclick="upload(20)"> Upload Test </button>
  <div id="download_res"></div>
  
</body>
</html>
